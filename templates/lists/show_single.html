{% extends "lists/base.html" %}
{% load profile %}
{% load staticfiles %}
{% load mptt_comments_tags %}
{% load crispy_forms_tags %}

{% block meta %}
<script type="text/javascript">var jq = true;</script>
{% endblock %}

{% block title %}
    {{ list.title }}
{% endblock %}


{% block extrahead %}
{% if request.user.is_authenticated %}
  <link rel="stylesheet" type="text/css" href="{% static "js/jquery-ui/theme/jquery-ui.css" %}" />
  <link href="{% static "js/tagit/theme/jquery.tagit.css" %}" rel="stylesheet" type="text/css"/>
{% endif %}
{% endblock %}

{% block headline %}
    lolo
{% endblock %}

{% block breadcrumb %}
    <li class="current"><a href="#">Index</a></li>
{% endblock %}

{% block content %}

  <div class="row">
    <div class="small-12 columns">
        <p>
          <ul class="inline-list">
            {% for tag, count in tags %}
            <li><a href="#" class="radius secondary label">{{ tag }} ({{ count }})</a></li>
            {% endfor %}
          </ul>
        </p>
    </div>
  </div>

<div class="row">
  <div class="large-12 columns">
    <h3><a href="{{ list.url }}">{{ list.title }}</a></h3>
    <p>{{ list.description }}</p>
    <p class="byline">
      {% with author=list.owner %}
      by <a href="{% url "user-url" author.username %}">{{ author.username }}</a> | {{ list.pubdate|timesince }} ago{% if author = request.user %} | <a href="{% url "list-edit" list_pk=list.pk list_slug=list.slug %}">edit</a>{% endif %}
      {%endwith%}
    </p>
  </div>
</div>

<div class="row">
  <div class="large-12 columns{% if list.owner = request.user %} my-def-list{% endif %}">
    {% if list.title in default_lists %}
    {% with links=list.links.all %}
      {% for link in links %}
      <hr />
      <h4><a href="{{ link.get_absolute_url }}"><i class="lsf symbol i-b">link</i> {{ forloop.counter }}.</a> <a href="{{ link.url }}">{{ link.title }}</a>{% if list.owner = request.user %}<span class="del has-tip tip-top" data-tooltip title="Remove link from list"> x </span>{% endif %}</h4>
      <p class="byline">
        <a href="{{ link.get_absolute_url }}">{{ link.get_comment_count }} comments</a> | {{ link.pubdate|timesince }} ago
      </p>
      {% endfor %}
    {% endwith %}
    {% else %}
    <div class="listcontent">
    {{ list.html_content|safe }}
    </div>
    {% endif %}
  </div>
</div>

{% if list.title not in default_lists %}
<div class="row">
  <div class="large-12 columns">
    {% display_comment_toplevel_for list %}
  </div>
</div>
{% endif %}
{% endblock %}


{% block last_body %}
{% if request.user.is_authenticated %}
<script type="text/javascript" src="{% static "js/jquery-ui/jquery-ui.min.js" %}" ></script>
<script type="text/javascript" src="{% static "js/tagit/tag-it.min.js" %}" ></script>
<script type="text/javascript">

</script>
<script type="text/javascript">
  $(function(){
      $("#id_tags").tagit({
        availableTags: [{{ tags_addlink|safe }}],
        autocomplete: {delay: 0, minLength: 2}
    });

    $('.listcontent').find('a').each(function(index, item) {
      $item = $(item);
      if($item.text() === 'link') {
        $item.addClass('lsf symbol');
      }
    });

    $('.listcontent').find('a').each(function(){
      if($(this).hasClass('addthis')) {
        $(this).on('click', function() {
          var link = $(this).prev('a');
          var url = link.attr('href')
          var title = link.html();
          $('#id_url').val(url);
          $('#id_title').val(title);
          $('#addmodal').foundation('reveal', 'open');
        });
      }
    });

  });
</script>

<div id="addmodal" class="reveal-modal">
  <h2>Add this link</h2>
  {% crispy form %}
  <a class="close-reveal-modal">&#215;</a>
</div>
{% else %}
<script>
$('.listcontent').find('a').each(function(){
  if($(this).hasClass('addthis')) {
    $(this).remove();
  }
});
</script>
{% endif %}
{% endblock last_body %}
