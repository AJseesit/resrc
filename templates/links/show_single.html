{% extends "links/base.html" %}
{% load profile %}
{% load mptt_comments_tags %}
{% load staticfiles %}

{% block title %}
    lala
{% endblock %}

{% block headline %}
    lolo
{% endblock %}

{% block breadcrumb %}
    <li class="current"><a href="#">Index</a></li>
{% endblock %}

{% block content %}

  <div class="row">
    <div class="small-9 columns">
        <p>
          <ul class="inline-list">
            <li><a href="#" class="radius secondary label">Tag 1</a></li>
            <li><a href="#" class="radius secondary label">Tag 2</a></li>
            <li><a href="#" class="radius secondary label">Tag 3</a></li>
            <li><a href="#" class="radius secondary label">Tag 4</a></li>
            <li><a href="#" class="radius secondary label">Tag 5</a></li>
          </ul>
        </p>
    </div>
    <div class="small-3 columns text-right big-black-ic"><!-- FIXME: this is ugly. Need classes instead of inline styles. -->
        <i class="lsf symbol" id="bookmark" style="color:{% if 'Bookmarks' in titles %}#2ba6cb{%else%}black{%endif%}">addstar</i>
        <i class="lsf symbol" id="toread" style="color:{% if 'Reading list' in titles %}#2ba6cb{%else%}black{%endif%}">save</i>
        <i class="lsf symbol" data-reveal-id="add-to-list">list</i>
    </div>
  </div>

  <div class="row">
    <div class="large-12 columns">
      <h3><a href="{{ link.url }}">{{ link.title }}</a></h3>
      <p class="byline">
        {% with author=link.author %}
        by <a href="{% url "user-url" author.username %}">{{ author.username }}</a> | {{ link.pubdate|timesince }} ago
        {%endwith%}
      </p>
    </div>
  </div>


<div class="row">
  <div class="large-12 columns">
    <p>
    {% display_comment_toplevel_for link %}
    </p>
  </div>
</div>

{% endblock %}


{% block last_body %}
  <script>
  function add_to_list(list) {
    $("#"+list).css('color', '#bbb');
    $.ajax({
      type:"POST",
      url:"{% url "ajax_add_to_default_list" %}",
      data: 'csrfmiddlewaretoken={{csrf_token}}&lk={{ link.pk }}&t='+list,
      error: function(xhr) {
        result = $.parseJSON(xhr.response).result;
        if (result == 'added') {
          $("#"+list).css('color', '#2ba6cb');
        } else {
            $("#"+list).css('color', 'black');
        }
      }
    });
  }
  $("#bookmark").click(function() {
    add_to_list('bookmark');
  });
  $("#toread").click(function() {
    add_to_list('toread');
  });
  </script>

  {% mptt_comments_media_js %}
  <div id="add-to-list" class="small reveal-modal">
    <!-- TODO: We'd better this modal's content only when opened. It would be way lighter in terms of markup **and SQL Queries** -->
    <!-- EASY :] http://foundation.zurb.com/docs/components/reveal.html -->
    <form>
      <fieldset>
        <legend>Add to list</legend>
        <div class="row">
          <div class="small-8 columns">
            {% for list in lists %}
            <label for="list-{{ list.pk }}">
                <input type="checkbox" value="{{ list.pk }}" name="sel_listes[{{ list.pk }}]" id="list-{{ list.pk }}" {% if list.title in titles %}checked="checked"{% endif %}/>
                {{ list.title }} <span>({{ list.links.count }} links)</span>
            </label>
            {% endfor %}
          </div>
        </div>
        <div class="row">
          <div class="small-6 columns">
            <!-- FIXME: Do we really want these two modals to be forms ? Ajax goodness anyone ?-->
            <button type="submit" name="move" class="small button">Update</button>
          </div>
          <div class="small-6 columns text-right">
            <a href="#" data-reveal-id="create-list"><span class="lsf symbol" style="color: black">list</span> New List</a>
          </div>
        </div>
      </fieldset>
    </form>

    <a class="close-reveal-modal">&#215;</a>
  </div>

  <div id="create-list" class="small reveal-modal">
    <form>
      <fieldset>
        <legend>Create a list</legend>
        <!-- TODO: use Crispy Forms here. Crispy Form through Ajax. Yeah. Hmmm. Cf. l107-->
        <div class="row">
          <div class="large-4 columns">
            <label for="ordered">
              <input type="checkbox" id="ordered" name="ordered"> Ordered
            </label>
          </div>
          <div class="large-4 columns">
            <label for="private">
              <input type="checkbox" id="private" name="private"> Private
            </label>
          </div>
        </div>
        <div class="row">
          <div class="large-12 columns">
            <label for="private">
              <label>Title *</label>
              <input type="text" name="title">
            </label>
          </div>
        </div>

        <div class="row">
          <div class="large-12 columns">
            <label>Description</label>
            <textarea name="description" id="description" data-container="description"></textarea>
          </div>
        </div>
        <div class="row">
          <div class="large-12 columns">
            <input type="submit" class="button" value="Create" />
          </div>
        </div>
      </fieldset>
    </form>
    <a class="close-reveal-modal">&#215;</a>
  </div>
{% endblock last_body %}
